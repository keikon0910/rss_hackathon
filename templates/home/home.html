<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BeLocal — 場所でつながる</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    #map { width: 100%; height: 70vh; }
    body {
      font-family: 'Noto Sans JP', ui-sans-serif, system-ui, -apple-system,
                   BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue",
                   Arial, "Noto Sans", sans-serif, "Apple Color Emoji",
                   "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }
  </style>
</head>
<body class="bg-zinc-50">
  <header class="sticky top-0 z-10 bg-white border-b border-gray-200">
    <div class="max-w-5xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2 font-extrabold tracking-tight">
        <div class="w-9 h-9 rounded-full bg-blue-100 grid place-items-center">SNS</div>
        <span>Social</span>
      </div>
      <!-- CTA（href は後で JS で上書きする） -->
      <div id="post-cta" class="ml-4 text-sm text-gray-600">
        <a id="cta-link"
           href="#"
           style="display:none;padding:10px 14px;border-radius:8px;background:#2563eb;color:#fff;text-decoration:none;">
          この場所（<span id="cta-name">ランドマーク</span>）で投稿
        </a>
        <span id="cta-msg" style="color:#666;">近くのランドマーク内ではありません</span>
      </div>
      <nav class="ml-auto">
        <ul class="flex items-center gap-4 font-semibold">
          <li><a href="{{ url_for('home.home') }}" class="px-2 py-1 hover:underline">ホーム</a></li>
          <!-- ★ id を付ける -->
          <li><a id="nav-post-link" href="{{ url_for('photograph.post') }}" class="px-2 py-1 hover:underline">投稿</a></li>
          <li><a href="{{ url_for('personal_page.personal_page') }}" class="px-2 py-1 hover:underline">マイページ</a></li>
        </ul>
      </nav>
    </div>
  </header>
  <main class="max-w-5xl mx-auto px-4">
  <!-- 地図 -->
  <div id="map" class="rounded-xl shadow mb-6" style="height:70vh;"></div>

  <!-- 地図下に横幅いっぱいのパネル -->
  <aside id="landmark-panel"
         class="w-full rounded-xl border border-gray-200 bg-white p-6 shadow hidden">
    <h2 id="lmName" class="text-xl font-bold mb-4">ランドマーク名</h2>
    <div class="flex flex-col sm:flex-row gap-3">
      <a id="readLink"
         href="#"
         class="flex-1 text-center border py-3 rounded-lg hover:bg-gray-50">
        この場所の投稿を見る
      </a>
    </div>
  </aside>

<p id="landmark-info" class="text-xs text-gray-500 mt-3">
  ランドマークをクリックすると下のパネルに表示されます
</p>

</main>


<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
<script src="{{ url_for('static', filename='js/home.js') }}"></script>

<script>
  // 例: ランドマークデータ
  // 実際は Flask から JSON で渡すか、JS 側で定義
  const landmarks = [
    { id: 1, name: "東京タワー", lat: 35.6586, lng: 139.7454 },
    { id: 2, name: "浅草寺", lat: 35.7148, lng: 139.7967 },
    // 他のランドマークも追加
  ];

  // ランドマーククリック時にパネル表示・リンク書き換え
  function showLandmarkPanel(landmark) {
    // パネル表示
    const panel = document.getElementById('landmark-panel');
    panel.classList.remove('hidden');

    // ランドマーク名表示
    document.getElementById('lmName').textContent = landmark.name;

    // 「この場所の投稿を見る」リンクの href を設定
    const readLink = document.getElementById('readLink');
    readLink.href = `/others/others_post/${landmark.id}`;

    // 「この場所に投稿する」リンクもあれば同様に設定
    const postLink = document.getElementById('postLink');
    if (postLink) {
      postLink.href = `/post?landmark_id=${landmark.id}`;
    }
  }

  // Leaflet 地図初期化
  const map = L.map("map").setView([35.68, 139.76], 13);
  L.tileLayer("https://osm.gdl.jp/styles/osm-bright-ja/{z}/{x}/{y}.png", {
    attribution: "© OpenStreetMap contributors, GDL.jp",
  }).addTo(map);

  // ランドマークにマーカー設置
  landmarks.forEach(lm => {
    const marker = L.marker([lm.lat, lm.lng]).addTo(map);
    marker.on('click', () => {
      showLandmarkPanel(lm); // クリックしたランドマークの情報を渡す
    });
  });
</script>


</body>
</html>